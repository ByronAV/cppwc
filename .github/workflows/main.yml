name: Format, Build and Test

on: [push, pull_request]

jobs:
    format-check:
        name: Formatting Check
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Install clang-format
              run: sudo apt-get install clang-format

            - name: Run clang-format
              run: |
                clang-format --version
                find . -name "*.cpp" -o -name "*.hpp" | xargs clang-format -style=google -i
                git diff --exit-code
              continue-on-error: true # Don't stop the pipeline on error
    
    test:
        name: Test Project
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Install dependencies
              run: |
                sudo apt-get update
                sudo apt-get install -y build-essential cmake libboost-all-dev  # Install Boost

            - name: Build project with CMake
              run: |
                mkdir -p build
                cd build
                cmake -DBUILD_TESTING=ON ..
                make
                ./cppwc_test